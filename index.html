<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>The Blaze Java | Postulaciones</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#0b0c10;
  color:#e4e6eb;
}
.container{max-width:1200px;margin:auto;padding:40px 20px}
h1{text-align:center;margin-bottom:30px}

.card{
  background:#111318;
  border-radius:14px;
  padding:25px;
  box-shadow:0 0 30px rgba(0,0,0,.7);
  margin-bottom:30px;
}

label{display:block;margin-top:15px;font-size:14px}
input, textarea, select{
  width:100%;
  padding:10px;
  margin-top:5px;
  border-radius:8px;
  border:none;
  background:#2b2d31;
  color:white;
}

button{
  margin-top:25px;
  padding:12px;
  border:none;
  border-radius:8px;
  background:#43b581;
  color:white;
  font-weight:bold;
  cursor:pointer;
}
button:hover{opacity:.9}

/* ADMIN */
.admin-btn{
  position:fixed;
  top:15px;
  right:15px;
  background:#5865f2;
  padding:10px 14px;
  border-radius:8px;
  font-size:14px;
}

#adminPanel{
  display:none;
  position:fixed;
  inset:0;
  background:#0b0c10;
  overflow:auto;
  padding:30px;
}

.post{
  background:#1c1f26;
  border-radius:12px;
  padding:20px;
  margin-bottom:20px;
}

.post h4{margin-top:0}
.row{margin-bottom:6px;font-size:14px}

.delete{
  background:#f04747;
  margin-top:15px;
}

.close{
  background:#444;
  margin-bottom:20px;
}
</style>
</head>

<body>

<button class="admin-btn" onclick="abrirAdmin()">Panel Admin</button>

<div class="container">
<h1>Postulación Staff – The Blaze Java</h1>

<div class="card">
<label>Nick de Minecraft</label><input id="nick_mc">
<label>Nick de Discord</label><input id="discord">
<label>Edad</label>
<select id="edad"><option>Menos de 12</option><option>12</option><option>Más de 12</option></select>
<label>¿Premium?</label>
<select id="premium"><option>Si</option><option>No</option></select>
<label>Tiempo jugando Minecraft</label><input id="tiempo_mc">
<label>¿Activo?</label><select id="activo_mc"><option>Si</option><option>No</option></select>
<label>¿Conoces la ID? Explícala</label><textarea id="id_conocimiento"></textarea>
<label>Sanciones en Minecraft</label><textarea id="sanciones"></textarea>
<label>Sanciones Discord TheBlaze</label><textarea id="sanciones_dc"></textarea>
<label>Diferencia Spam y Flood</label><textarea id="diferencia_spam"></textarea>
<label>¿Qué es un Warn?</label><textarea id="warn"></textarea>
<label>¿Staff en otra network?</label><select id="staff_otro"><option>Si</option><option>No</option></select>
<label>Experiencia como staff</label><textarea id="exp_staff"></textarea>
<label>Experiencia programando</label><textarea id="exp_programador"></textarea>
<label>10 bots que no estén en TheBlaze</label><textarea id="bots"></textarea>
<label>¿Qué harías ante algo ilegal?</label><textarea id="ilegal_servidor"></textarea>
<label>10 comandos útiles Discord</label><textarea id="cmds_discord"></textarea>
<label>10 comandos útiles Nautic</label><textarea id="cmds_nautic"></textarea>
<label>Si tu amigo hace algo ilegal</label><textarea id="amigo_ilegal"></textarea>
<label>¿Staff corrupto?</label><textarea id="staff_corrupto"></textarea>
<label>¿Aceptas el rol staff?</label><select id="acepta_staff"><option>Si</option><option>No</option></select>

<button onclick="enviar()">Enviar Postulación</button>
</div>
</div>

<!-- PANEL ADMIN -->
<div id="adminPanel">
<button class="close" onclick="cerrarAdmin()">Cerrar Panel</button>
<h2>Postulaciones Recibidas</h2>
<div id="posts"></div>
</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabase = createClient(
  "https://bvbneelfosacutwhjzhx.supabase.co",
  "sb_publishable_8QluYXwqMPxYWszgJlCbzw_EdakwSl-"
);

window.enviar = async ()=>{
  const { error } = await supabase.from("postulaciones").insert([{
    rango:"soporte",
    nick_mc:nick_mc.value,
    discord:discord.value,
    edad:edad.value,
    premium:premium.value,
    tiempo_mc:tiempo_mc.value,
    activo_mc:activo_mc.value,
    id_conocimiento:id_conocimiento.value,
    sanciones:sanciones.value,
    sanciones_dc:sanciones_dc.value,
    diferencia_spam:diferencia_spam.value,
    warn:warn.value,
    staff_otro:staff_otro.value,
    exp_staff:exp_staff.value,
    exp_programador:exp_programador.value,
    bots:bots.value,
    ilegal_servidor:ilegal_servidor.value,
    cmds_discord:cmds_discord.value,
    cmds_nautic:cmds_nautic.value,
    amigo_ilegal:amigo_ilegal.value,
    staff_corrupto:staff_corrupto.value,
    acepta_staff:acepta_staff.value
  }]);
  if(error){alert("❌ Error");console.log(error);}
  else{alert("✅ Enviada");location.reload();}
};

window.abrirAdmin = ()=>{
  const pass = prompt("Contraseña Admin");
  if(pass!=="1.21 #3 parcelas") return alert("❌ Incorrecta");
  adminPanel.style.display="block";
  cargar();
};

window.cerrarAdmin=()=>adminPanel.style.display="none";

async function cargar(){
  const { data } = await supabase.from("postulaciones").select("*").order("id",{ascending:false});
  posts.innerHTML="";
  data.forEach(p=>{
    posts.innerHTML+=`
    <div class="post">
      <h4>${p.nick_mc} | ${p.discord}</h4>
      ${Object.entries(p).map(([k,v])=>k!=="id"&&k!=="created_at"?`<div class="row"><b>${k}</b>: ${v}</div>`:"").join("")}
      <button class="delete" onclick="eliminar(${p.id})">Eliminar</button>
    </div>`;
  });
}

window.eliminar = async(id)=>{
  if(confirm("Eliminar postulación?")){
    await supabase.from("postulaciones").delete().eq("id",id);
    cargar();
  }
};
</script>

</body>
</html>
