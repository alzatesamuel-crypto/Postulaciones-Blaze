<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>The Blaze Java | Postulaciones</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    background:radial-gradient(circle at top,#111,#000);
    color:#e4e6eb;
}
.container{max-width:1200px;margin:auto;padding:40px 20px}
h1{text-align:center;margin-bottom:40px}
.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:25px}

.card{
    background:linear-gradient(180deg,#0f1115,#0a0b0e);
    border-radius:16px;
    padding:25px;
    box-shadow:0 0 40px rgba(0,0,0,.8);
    display:flex;
    flex-direction:column;
    justify-content:space-between
}
.icon{
    width:50px;height:50px;
    background:#7c6a00;
    border-radius:12px;
    display:flex;align-items:center;justify-content:center;
    margin-bottom:20px
}
.card h2{margin:0 0 10px}
.card p{color:#9da1a9;font-size:14px}

.alert{
    margin:20px 0;
    padding:12px;
    border-radius:10px;
    background:rgba(240,71,71,.15);
    color:#f04747;
    display:flex;
    gap:8px;
    font-size:14px
}

button{
    padding:12px;
    border-radius:10px;
    border:none;
    font-weight:bold;
    cursor:pointer;
    font-size:15px
}
.btn-open{background:linear-gradient(135deg,#43b581,#2ea043);color:white}
.btn-closed{background:#2b2d31;color:#72767d;cursor:not-allowed}
.admin{margin-top:10px;background:#5865f2;color:white}

.modal{
    position:fixed;inset:0;
    background:rgba(0,0,0,.8);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:10
}
.modal-content{
    background:#1c1f26;
    padding:30px;
    border-radius:16px;
    max-width:600px;
    width:90%;
    max-height:80vh;
    overflow-y:auto;
}
label{display:block;margin-top:15px;font-size:14px}
input, textarea{
    width:100%;
    padding:10px;
    margin-top:5px;
    border-radius:8px;
    border:none;
    background:#2b2d31;
    color:white;
}
.modal button{margin-top:20px;width:100%;background:#5865f2;color:white}
</style>
</head>

<body>

<div class="container">
<h1>Postulaciones The Blaze Java</h1>

<div class="cards">
<div class="card">
<div>
<div class="icon">ðŸ“„</div>
<h2>Rango SOPORTE</h2>
<p>PostulaciÃ³n para formar parte del equipo de soporte.</p>
<div class="alert" id="alert-soporte">Cargando estado...</div>
</div>

<button id="btn-postular" class="btn-open" onclick="abrir()">Postularse</button>
<button class="admin" onclick="togglePostulaciones()">Abrir / Cerrar postulaciones</button>
<button class="admin" onclick="verPostulaciones()">Ver postulaciones</button>

</div>
</div>
</div>

<!-- MODAL POSTULAR -->
<div class="modal" id="modal">
<div class="modal-content">
<h3>PostulaciÃ³n - SOPORTE</h3>

<label>Tu nombre de Discord:</label>
<input id="discord">

<label>Â¿Por quÃ© quieres ser soporte?</label>
<textarea id="motivo"></textarea>

<label>Â¿CuÃ¡nto tiempo podrÃ­as dedicar?</label>
<textarea id="tiempo"></textarea>

<label>Â¿Tienes experiencia?</label>
<textarea id="experiencia"></textarea>

<button onclick="enviar()">Enviar PostulaciÃ³n</button>
</div>
</div>

<!-- MODAL VER POSTULACIONES -->
<div class="modal" id="modal-postulaciones">
<div class="modal-content">
<h3>Postulaciones - SOPORTE</h3>
<div id="lista-postulaciones"></div>
<button onclick="cerrarPostulaciones()">Cerrar</button>
</div>
</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabaseUrl = "https://bvbneelfosacutwhjzhx.supabase.co";
const supabaseKey = "sb_publishable_8QluYXwqMPxYWszgJlCbzw_EdakwSl-";
const supabase = createClient(supabaseUrl, supabaseKey);

// ---------- MODAL POSTULAR ----------
window.abrir = () => {
  document.getElementById("modal").style.display = "flex";
};

// ---------- ENVIAR POSTULACIÃ“N ----------
window.enviar = async () => {
  const discord = document.getElementById("discord").value.trim();
  const motivo = document.getElementById("motivo").value.trim();
  const tiempo = document.getElementById("tiempo").value.trim();
  const experiencia = document.getElementById("experiencia").value.trim();

  if (!discord) {
    alert("Debes poner tu Discord");
    return;
  }

  const { error } = await supabase.from("postulaciones").insert([{
    rango: "soporte",
    discord,
    motivo,
    tiempo,
    experiencia
  }]);

  if (error) {
    alert("âŒ Error al enviar");
    console.error(error);
  } else {
    alert("âœ… PostulaciÃ³n enviada");
    document.getElementById("modal").style.display = "none";
  }
};

// ---------- ESTADO POSTULACIONES ----------
async function cargarEstado() {
  const { data } = await supabase
    .from("config")
    .select("value")
    .eq("key", "soporte_abierto")
    .single();

  const abierta = data.value;
  const alert = document.getElementById("alert-soporte");
  const btn = document.getElementById("btn-postular");

  if (abierta === true) {
    alert.textContent = "ðŸŸ¢ PostulaciÃ³n ABIERTA";
    alert.style.color = "#43b581";
    btn.disabled = false;
    btn.className = "btn-open";
  } else {
    alert.textContent = "ðŸ”´ PostulaciÃ³n CERRADA";
    alert.style.color = "#f04747";
    btn.disabled = true;
    btn.className = "btn-closed";
  }
}

// ---------- ABRIR / CERRAR ----------
window.togglePostulaciones = async () => {
  const { data } = await supabase
    .from("config")
    .select("value")
    .eq("key", "soporte_abierto")
    .single();

  await supabase
    .from("config")
    .update({ value: !data.value })
    .eq("key", "soporte_abierto");

  cargarEstado();
};

// ---------- VER POSTULACIONES ----------
window.verPostulaciones = async () => {
  document.getElementById("modal-postulaciones").style.display = "flex";

  const { data } = await supabase
    .from("postulaciones")
    .select("*")
    .eq("rango", "soporte")
    .order("id", { ascending: false });

  const lista = document.getElementById("lista-postulaciones");
  lista.innerHTML = "";

  data.forEach(p => {
    lista.innerHTML += `
      <div style="background:#2b2d31;padding:10px;border-radius:10px;margin-bottom:10px">
        <b>${p.discord}</b><br>
        <small>${p.motivo}</small>
      </div>
    `;
  });
};

window.cerrarPostulaciones = () => {
  document.getElementById("modal-postulaciones").style.display = "none";
};

// ---------- INICIO ----------
cargarEstado();
</script>

</body>
</html>







