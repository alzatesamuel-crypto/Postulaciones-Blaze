<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>The Blaze Java | Postulaciones</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:radial-gradient(circle at top,#111,#000);
  color:#e4e6eb;
}
.container{max-width:1200px;margin:auto;padding:40px 20px}
h1{text-align:center;margin-bottom:40px}
.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:25px}

.card{
  background:#0f1115;
  border-radius:16px;
  padding:25px;
  box-shadow:0 0 40px rgba(0,0,0,.8);
}
.icon{
  width:50px;height:50px;
  background:#7c6a00;
  border-radius:12px;
  display:flex;
  align-items:center;
  justify-content:center;
  margin-bottom:20px
}
.alert{
  margin:15px 0;
  padding:10px;
  border-radius:10px;
  background:rgba(240,71,71,.15);
  color:#f04747;
}
button{
  padding:12px;
  border-radius:10px;
  border:none;
  font-weight:bold;
  cursor:pointer;
}
.btn-open{background:#2ea043;color:white}
.btn-closed{background:#2b2d31;color:#777;cursor:not-allowed}

#btnAdmin{
  position:fixed;
  top:15px;
  right:15px;
  background:#5865f2;
  color:white;
  padding:10px 14px;
  border-radius:10px;
  z-index:50;
}

.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.8);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:20;
}
.modal-content{
  background:#1c1f26;
  padding:30px;
  border-radius:16px;
  max-width:600px;
  width:90%;
  max-height:80vh;
  overflow-y:auto;
}
input,textarea{
  width:100%;
  padding:10px;
  margin-top:10px;
  border-radius:8px;
  border:none;
  background:#2b2d31;
  color:white;
}
.admin-panel{display:none;margin-top:40px}
.post-card{
  background:#111;
  padding:15px;
  border-radius:10px;
  margin:10px 0;
}
</style>
</head>

<body>

<button id="btnAdmin" onclick="mostrarLogin()">‚öô Admin</button>

<div class="container">
<h1>Postulaciones The Blaze Java</h1>

<div class="cards">
<div class="card">
<div class="icon">üìÑ</div>
<h2>Rango SOPORTE</h2>
<p>Postulaci√≥n para formar parte del equipo de soporte.</p>
<div class="alert" id="estado">Cargando...</div>
<button id="btnPostular" class="btn-open" onclick="abrir()">Postularse</button>
</div>
</div>

<!-- PANEL ADMIN -->
<div class="admin-panel" id="adminPanel">
<h2>Panel de Administraci√≥n</h2>
<button onclick="abrirPost()">Abrir postulaciones</button>
<button onclick="cerrarPost()">Cerrar postulaciones</button>

<h3>Postulaciones recibidas</h3>
<div id="lista"></div>
</div>
</div>

<!-- MODAL POSTULAR -->
<div class="modal" id="modal">
<div class="modal-content">
<h3>Postulaci√≥n - SOPORTE</h3>

<input id="discord" placeholder="Tu usuario de Discord (incluye # y n√∫meros)">

<textarea id="motivo" placeholder="¬øPor qu√© quieres formar parte del equipo de soporte de The Blaze Java?
Explica tus razones y qu√© aportar√≠as al servidor."></textarea>

<textarea id="tiempo" placeholder="¬øCu√°nto tiempo puedes dedicar al servidor?
Indica horas aproximadas por d√≠a y d√≠as de la semana."></textarea>

<textarea id="experiencia" placeholder="¬øTienes experiencia como staff o moderador?
Menciona servidores, rangos anteriores o situaciones que hayas manejado.
(Si no tienes experiencia, expl√≠calo igualmente)"></textarea>

<button onclick="enviar()">Enviar postulaci√≥n</button>
</div>
</div>

<!-- LOGIN ADMIN -->
<div class="modal" id="loginModal">
<div class="modal-content">
<h3>Acceso Admin</h3>
<input type="password" id="password" placeholder="Contrase√±a">
<button onclick="login()">Entrar</button>
</div>
</div>

<!-- VER POSTULACI√ìN -->
<div class="modal" id="verModal">
<div class="modal-content">
<h3>Postulaci√≥n completa</h3>
<div id="detallePost"></div>
<button onclick="verModal.style.display='none'">Cerrar</button>
</div>
</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabase = createClient(
  "https://bvbneelfosacutwhjzhx.supabase.co",
  "sb_publishable_8QluYXwqMPxYWszgJlCbzw_EdakwSl-"
);

/* ESTADO POSTULACIONES */
async function cargarEstado(){
  const { data } = await supabase
    .from("config")
    .select("abiertas")
    .eq("id",1)
    .single();

  const abierta = data.abiertas;
  estado.innerText = abierta ? "üü¢ POSTULACIONES ABIERTAS" : "üî¥ POSTULACIONES CERRADAS";
  btnPostular.disabled = !abierta;
  btnPostular.className = abierta ? "btn-open" : "btn-closed";
}
cargarEstado();

/* POSTULAR */
window.abrir = () => modal.style.display="flex";

window.enviar = async () => {
  if(!discord.value.trim()){
    alert("Debes ingresar tu Discord");
    return;
  }

  await supabase.from("postulaciones").insert([{
    rango:"soporte",
    discord:discord.value,
    motivo:motivo.value,
    tiempo:tiempo.value,
    experiencia:experiencia.value
  }]);

  alert("‚úÖ Postulaci√≥n enviada correctamente");
  modal.style.display="none";
};

/* ADMIN */
window.mostrarLogin = () => loginModal.style.display="flex";

window.login = () => {
  if(password.value==="1.21 #3 parcelas"){
    loginModal.style.display="none";
    adminPanel.style.display="block";
    cargarPostulaciones();
  }else{
    alert("‚ùå Contrase√±a incorrecta");
  }
};

async function cargarPostulaciones(){
  const { data } = await supabase.from("postulaciones").select("*");
  lista.innerHTML="";
  data.forEach(p=>{
    lista.innerHTML+=`
    <div class="post-card">
      <b>${p.discord}</b><br><br>
      <button onclick='verPost(${JSON.stringify(p)})'>Ver completa</button>
      <button onclick='borrar(${p.id})'>Borrar</button>
    </div>`;
  });
}

window.verPost = (p) => {
  detallePost.innerHTML = `
    <b>Discord:</b> ${p.discord}<br><br>
    <b>Motivo:</b><br>${p.motivo}<br><br>
    <b>Tiempo disponible:</b><br>${p.tiempo}<br><br>
    <b>Experiencia:</b><br>${p.experiencia}
  `;
  verModal.style.display="flex";
};

window.borrar = async (id) => {
  await supabase.from("postulaciones").delete().eq("id",id);
  cargarPostulaciones();
};

window.abrirPost = async () => {
  await supabase.from("config").update({abiertas:true}).eq("id",1);
  cargarEstado();
};

window.cerrarPost = async () => {
  await supabase.from("config").update({abiertas:false}).eq("id",1);
  cargarEstado();
};
</script>

</body>
</html>







